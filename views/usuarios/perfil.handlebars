{{>_navb}}
<section class="banner-area bg_cover">
    <div class="container">
        <div class="row">
            <div class="col-lg-6">
                <div class="banner-content">
                    <h1 class="text-white">Dados do perfil</h1>
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="index">Home</a></li>
                            <li class="breadcrumb-item active" aria-current="page">Ads</li>
                        </ol>
                    </nav>
                </div>
            </div>
        </div>
    </div>
</section>

{{>_menu}}
            <div class="col-xl-7 col-lg-8">
                <div class="post-ad-wrapper box-style">
                    <div class="title">
                        <h3 style="text-align: center;">Dados do usuário</h3></br>
                    </div>
                    <form action="/usuarios/salvarperfil" method="POST">
                        <div class="container">
                            <form>
                                <input type="hidden" value="{{usuario._id}}" id="id" name="id">
                                <div class="col-md">
                                    <div class="form-floating">
                                        <input type="text" class="form-control" id="nick" name="nick" placeholder="0"
                                            value="{{usuario.nick}}">
                                        <label for="nick">Nome do usuário</label>
                                    </div>
                                </div>
                                <div class="row g-2">
                                    <div class="col-md">
                                        <div class="form-floating">
                                            <input type="text" class="form-control" id="celular" name="celular"
                                                placeholder="0" value="{{usuario.celular_user}}">
                                            <label for="celcomercial">Celular</label>
                                        </div>
                                    </div>
                                    <div class="col-md">
                                        <div class="form-floating">
                                            <input type="email" class="form-control" id="email" name="email"
                                                placeholder="0" value="{{usuario.email}}">
                                            <label for="email">Email</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="row g-2">
                                        <div class="col-md">
                                            <div class="form-floating mb-3">
                                                <input type="text" class="form-control" id="cpf" name="cpf"
                                                    placeholder="name@example.com" onkeyup="cpfCheck(this)"
                                                    maxlength="18" onkeydown="javascript: fMasc( this, mCPF );"
                                                    onblur="cpfvalid(this)" value="{{usuario.cpf_user}}" required>
                                                <label for="cpf">CPF</label>
                                                <span class="d-inline" id="cpfResponse" name="cpfResponse"></span>
                                                <input type="hidden" id="validacpf" name="validacpf">
                                            </div>
                                        </div>
                                        <div class="col-md">
                                            <div class="form-floating mb-3">
                                                <input type="date" class="form-control" name="idade" id='idade' value="{{usuario.data_idade}}"
                                                    onchange="ageCount()" maxlength="8" placeholder="name@example.com"
                                                    required>
                                                <label for="idade">Data de nascimento</label>
                                            </div>
                                            <input type="hidden" id="demo" name="demo">
                                        </div>
                                    </div>
                            </form>
                            <button class="main-btn btn-hover">Salvar</button>
                    </form>
                    <button type="button" data-bs-toggle="modal" class="btn btn-link" data-bs-target="#exampleModal">
                        Trocar senha
                    </button>
                </div>
            </div>
</section>
<form name="trocarsenha" action="/usuarios/trocar-senha" method="POST">
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Trocar Senha</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <span class="d-inline" id="msgsenha"></span></p>
                    <input type="hidden" id="valueid" name="valueid" value="{{usuario._id}}">
                    <div class="col-12">
                        <div class="single-form mb-20">
                            <label for="senha" class="mb-2">Senha</label>
                            <input type="password" onblur="validacaoSenha(this)" name="senha1" id="senha1"
                                placeholder="****" class="py-2 px-3 mb-0 rounded border">
                        </div>
                        <div class="col-12">
                            <div class="single-form mb-20">
                                <label for="senha" class="mb-2">Confirmar senha</label>
                                <input type="password" onblur="validacaoSenha(this)" name="senha2" id="senha2"
                                    placeholder="****" class="py-2 px-3 mb-0 rounded border">
                            </div>
                        </div>
                        <button type="submit" name="salvar" id="salvar" class="btn btn-primary" disabled>Salvar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>
<script>

    $(document).ready(() => {
        console.log('ij')
    })
    //Consulta o CEP

    const cep = document.querySelector("#cep")

    const showData = (result) => {
        for (const campo in result) {
            if (document.querySelector("#" + campo)) {
                document.querySelector("#" + campo).value = result[campo]
            }
        }
    }

    cep.addEventListener("blur", (e) => {
        let search = cep.value.replace("-", "")
        const options = {
            method: 'GET',
            mode: 'cors',
            cache: 'default'
        }

        fetch(`https://viacep.com.br/ws/${search}/json/`, options)
            .then(response => {
                response.json()
                    .then(data => showData(data))
            })
            .catch(e => console.log('Deu Erro: ' + e, message))
    })

</script>

<script>
    function validacaoSenha(field) {

        senhacont = field.value
        if ((senha1.value == senha2.value) && (senhacont.length >= 4)) {
            document.getElementById("msgsenha").innerHTML = "";
            document.getElementById("salvar").disabled = false;
        }
        else {
            document.getElementById("salvar").disabled = true;
            document.getElementById("msgsenha").innerHTML = "<font color='red'>Senhas divergentes ou muito curta!</font>";

        }
    }

    if ({{ usuario.eTipoconta }} == 1 ) {
        $("#dashboard").hide()
        $("#lojavirtual").hide()
        $("#myads").hide()

    }

</script>

<script>
    //verifica CPF

    function is_cpf(c) {

        if ((c = c.replace(/[^\d]/g, "")).length != 11)
            return false

        if (c == "00000000000" || c == "11111111111" || c == "22222222222" || c == "33333333333" || c == "44444444444" || c == "55555555555" || c == "66666666666" || c == "77777777777" || c == "88888888888" || c == "99999999999")
            return false;

        var r;
        var s = 0;

        for (i = 1; i <= 9; i++)
            s = s + parseInt(c[i - 1]) * (11 - i);

        r = (s * 10) % 11;

        if ((r == 10) || (r == 11))
            r = 0;

        if (r != parseInt(c[9]))
            return false;

        s = 0;

        for (i = 1; i <= 10; i++)
            s = s + parseInt(c[i - 1]) * (12 - i);

        r = (s * 10) % 11;

        if ((r == 10) || (r == 11))
            r = 0;

        if (r != parseInt(c[10]))
            return false;

        return true;
    }


    function fMasc(objeto, mascara) {
        obj = objeto
        masc = mascara
        setTimeout("fMascEx()", 1)
    }

    function fMascEx() {
        obj.value = masc(obj.value)
    }

    function mCPF(cpf) {
        cpf = cpf.replace(/\D/g, "")
        cpf = cpf.replace(/(\d{3})(\d)/, "$1.$2")
        cpf = cpf.replace(/(\d{3})(\d)/, "$1.$2")
        cpf = cpf.replace(/(\d{3})(\d{1,2})$/, "$1-$2")
        return cpf
    }

    cpfCheck = function (el) {

        document.getElementById('cpfResponse').innerHTML = is_cpf(el.value) ? '<i style="color: green" class="fas fa-check">Valido</i>' : '<i style="color: red" class="fas fa-times">Inválido</i>';

        if (document.getElementById('cpfResponse').textContent == "Inválido") {
            document.getElementById('validacpf').value = "Inválido"
            $('#salvar').attr("disabled", true);

        } if (document.getElementById('cpfResponse').textContent == "Valido") {
            document.getElementById('validacpf').value = "Valido"
            $('#salvar').attr("disabled", false);
        }

    }



    $("#cpf").mask("000.000.000-00");
</script>

<script>
    function ageCount() {


        var inputNascimento = document.getElementById("idade");
        var data = new Date(inputNascimento.value);
        if (isDate_(inputNascimento.value) && data.getFullYear() > 1900)
            document.getElementById("demo").value = calculateAge(inputNascimento.value);
    }

    function calculateAge(dobString) {
        var dob = new Date(dobString);
        var currentDate = new Date();
        var currentYear = currentDate.getFullYear();
        var birthdayThisYear = new Date(currentYear, dob.getMonth(), dob.getDate());
        var age = currentYear - dob.getFullYear();
        if (birthdayThisYear > currentDate) {
            age--;
        }
        return age;
    }

    function calcular(data) {
        var data = document.form.nascimento.value;
        alert(data);
        var partes = data.split("/");
        var junta = partes[2] + "-" + partes[1] + "-" + partes[0];
        document.form.idade.value = (calculateAge(junta));
    }

    var isDate_ = function (input) {
        var status = false;
        if (!input || input.length <= 0) {
            status = false;
        } else {
            var result = new Date(input);
            if (result == 'Invalid Date') {
                status = false;
            } else {
                status = true;
            }
        }
        return status;
    }



</script>